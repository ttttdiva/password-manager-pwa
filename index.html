<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0f0f1a">
  <meta name="description" content="セキュアなパスワードマネージャー - オフライン対応PWA">

  <title>Password Manager</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div id="app">
    <!-- ログイン画面 -->
    <section id="login-screen" class="screen login-screen active">
      <div class="login-logo">🔐</div>
      <h1 class="login-title">Password Manager</h1>
      <p class="login-subtitle">マスターパスワードでロック解除</p>

      <form class="login-form glass-card" id="login-form">
        <div class="input-group">
          <label class="input-label" for="master-password">マスターパスワード</label>
          <div class="input-wrapper">
            <input type="password" id="master-password" class="input-field" placeholder="パスワードを入力"
              autocomplete="current-password" required>
            <span class="input-icon" id="toggle-password">👁</span>
          </div>
        </div>

        <div id="confirm-password-group" class="input-group" style="display: none;">
          <label class="input-label" for="confirm-password">パスワード確認</label>
          <div class="input-wrapper">
            <input type="password" id="confirm-password" class="input-field" placeholder="もう一度入力"
              autocomplete="new-password">
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block" id="login-btn">
          <span id="login-btn-text">ロック解除</span>
        </button>
      </form>
    </section>

    <!-- パスワード一覧画面 -->
    <section id="list-screen" class="screen">
      <div class="header">
        <div>
          <h1 class="header-title">パスワード</h1>
          <p class="header-subtitle" id="password-count">0件のパスワード</p>
        </div>
        <button class="btn btn-icon btn-secondary" id="settings-btn" title="設定">⚙️</button>
      </div>

      <div class="search-bar">
        <span class="search-icon">🔍</span>
        <input type="text" class="search-input" id="search-input" placeholder="サービス名で検索...">
      </div>

      <div class="password-list" id="password-list">
        <!-- パスワードアイテムがここに挿入される -->
      </div>

      <div class="empty-state" id="empty-state" style="display: none;">
        <div class="empty-state-icon">🔑</div>
        <h3 class="empty-state-title">パスワードがありません</h3>
        <p>右下の + ボタンで追加しましょう</p>
      </div>

      <button class="fab" id="add-btn" title="パスワードを追加">＋</button>
    </section>

    <!-- パスワード詳細/編集画面 (統合) -->
    <section id="detail-screen" class="screen">
      <div class="header">
        <button class="back-btn" id="detail-back-btn">←</button>
        <div>
          <h1 class="header-title" id="detail-title">詳細</h1>
        </div>
      </div>

      <form class="glass-card" id="detail-form">
        <!-- サービス名 -->
        <div class="input-group">
          <label class="input-label" for="detail-service">サービス名 *</label>
          <input type="text" id="detail-service" class="input-field" placeholder="例: Google" required>
        </div>

        <!-- メールアドレス -->
        <div class="input-group">
          <label class="input-label" for="detail-email">メールアドレス</label>
          <div class="input-wrapper">
            <input type="text" id="detail-email" class="input-field" placeholder="例: user@example.com">
            <span class="input-icon copy-btn" data-field="email" title="コピー">📋</span>
          </div>
        </div>

        <!-- ユーザー名 -->
        <div class="input-group">
          <label class="input-label" for="detail-username">ユーザー名 *</label>
          <div class="input-wrapper">
            <input type="text" id="detail-username" class="input-field" placeholder="例: myusername" required>
            <span class="input-icon copy-btn" data-field="username" title="コピー">📋</span>
          </div>
        </div>

        <!-- パスワード -->
        <div class="input-group">
          <label class="input-label" for="detail-password">パスワード *</label>
          <div class="input-wrapper">
            <input type="password" id="detail-password" class="input-field" placeholder="パスワード" required>
            <span class="input-icon" style="right: 48px;" id="toggle-detail-password">👁</span>
            <span class="input-icon copy-btn" data-field="password" title="コピー">📋</span>
          </div>

          <!-- パスワード強度 -->
          <div class="strength-indicator" id="strength-indicator">
            <div class="strength-bar"></div>
            <div class="strength-bar"></div>
            <div class="strength-bar"></div>
            <div class="strength-bar"></div>
          </div>
          <div class="strength-label" id="strength-label"></div>

          <!-- パスワード生成ボタン (新規時のみ表示) -->
          <button type="button" class="btn btn-secondary btn-block" id="generate-password-btn"
            style="margin-top: var(--spacing-sm); margin-bottom: var(--spacing-sm); display: none;">
            🎲 パスワードを生成
          </button>
        </div>

        <!-- カスタムフィールド -->
        <div id="detail-custom-fields">
          <!-- カスタムフィールド入力がここに挿入される -->
        </div>

        <button type="button" class="btn btn-secondary btn-block" id="add-custom-field-btn"
          style="margin-bottom: var(--spacing-md); border-style: dashed;">
          ＋ フィールドを追加
        </button>

        <!-- メモ -->
        <div class="input-group">
          <label class="input-label" for="detail-memo">メモ</label>
          <textarea id="detail-memo" class="input-field" rows="3" placeholder="任意のメモ"></textarea>
        </div>

        <!-- アクションボタン -->
        <div class="detail-actions" style="margin-top: var(--spacing-lg);">
          <button type="submit" class="btn btn-primary" id="save-btn" style="flex: 2;">
            💾 保存
          </button>
          <button type="button" class="btn btn-danger" id="delete-btn" style="flex: 1;">
            🗑️ 削除
          </button>
        </div>
      </form>
    </section>

    <!-- 設定画面 -->
    <section id="settings-screen" class="screen">
      <div class="header">
        <button class="back-btn" id="settings-back-btn">←</button>
        <div>
          <h1 class="header-title">設定</h1>
        </div>
      </div>


      <div class="glass-card" style="margin-bottom: var(--spacing-md);">
        <h3 style="margin-bottom: var(--spacing-md);">🔄 GitHub同期</h3>
        <p id="sync-status"
          style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--spacing-md);">
          未設定
        </p>

        <div id="sync-config-group">
          <div class="input-group">
            <label class="input-label" for="github-repo-owner">リポジトリオーナー</label>
            <input type="text" id="github-repo-owner" class="input-field" placeholder="例: ttttdiva">
          </div>
          <div class="input-group">
            <label class="input-label" for="github-repo-name">リポジトリ名</label>
            <input type="text" id="github-repo-name" class="input-field" placeholder="例: 37_PasswordManager">
          </div>
          <div class="input-group">
            <label class="input-label" for="github-token">Personal Access Token</label>
            <input type="password" id="github-token" class="input-field" placeholder="ghp_...">
            <p style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">
              GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic) で作成。<br>
              権限: repo のみ必要。Privateリポジトリ対応。
            </p>
          </div>
          <button class="btn btn-primary btn-block" id="save-config-btn" style="margin-bottom: var(--spacing-md);">
            設定を保存
          </button>
        </div>

        <div id="sync-actions" style="display: none;">
          <p style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
            同期先: <span id="sync-repo-info"></span>
          </p>
          <button class="btn btn-secondary btn-block" id="sync-pull-btn" style="margin-bottom: var(--spacing-sm);">
            ⬇️ Pull（GitHubから取得）
          </button>
          <button class="btn btn-secondary btn-block" id="sync-push-btn" style="margin-bottom: var(--spacing-sm);">
            ⬆️ Push（GitHubへ保存）
          </button>
          <button class="btn btn-secondary btn-block" id="clear-config-btn" style="font-size: var(--font-size-sm);">
            🔓 設定をクリア
          </button>
        </div>
      </div>

      <div class="glass-card">
        <h3 style="margin-bottom: var(--spacing-md);">データ管理</h3>

        <button class="btn btn-secondary btn-block" id="export-btn" style="margin-bottom: var(--spacing-md);">
          📤 データをエクスポート
        </button>

        <button class="btn btn-secondary btn-block" id="import-btn" style="margin-bottom: var(--spacing-md);">
          📥 データをインポート
        </button>
        <input type="file" id="import-file" accept=".json" style="display: none;">

        <hr style="border-color: var(--border-color); margin: var(--spacing-lg) 0;">

        <button class="btn btn-danger btn-block" id="logout-btn">
          🔒 ロック
        </button>
      </div>
    </section>
  </div>

  <!-- 削除確認モーダル -->
  <div class="modal-overlay" id="delete-modal">
    <div class="modal">
      <h3 class="modal-title">削除の確認</h3>
      <p>このパスワードを削除しますか？この操作は取り消せません。</p>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancel-delete" style="flex: 1;">キャンセル</button>
        <button class="btn btn-danger" id="confirm-delete" style="flex: 1;">削除</button>
      </div>
    </div>
  </div>

  <!-- トースト -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script src="js/crypto.js?v=11"></script>
  <script src="js/storage.js?v=11"></script>
  <script src="js/password-generator.js?v=11"></script>
  <script src="js/github-sync.js?v=11"></script>
  <script src="js/app.js?v=11"></script>
</body>

</html>